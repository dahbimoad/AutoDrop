<ui:FluentWindow x:Class="AutoDrop.Views.Windows.AiSettingsWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 xmlns:viewmodels="clr-namespace:AutoDrop.ViewModels"
                 mc:Ignorable="d"
                 Title="AI Settings"
                 Width="550"
                 Height="650"
                 MinWidth="500"
                 MinHeight="550"
                 WindowStartupLocation="CenterOwner"
                 ExtendsContentIntoTitleBar="True"
                 d:DataContext="{d:DesignInstance viewmodels:AiSettingsViewModel, IsDesignTimeCreatable=False}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0" Title="AI Settings - Gemini Integration"/>

        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      Padding="24,16">
            <StackPanel>
                
                <!-- AI Feature Toggle -->
                <ui:CardControl Margin="0,0,0,16">
                    <ui:CardControl.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Enable AI Features" 
                                           FontWeight="SemiBold"
                                           FontSize="14"/>
                                <TextBlock Text="Use Google Gemini to analyze and categorize files automatically"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                           FontSize="12"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                            <ui:ToggleSwitch Grid.Column="1" 
                                          IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                          VerticalAlignment="Center"/>
                        </Grid>
                    </ui:CardControl.Header>
                </ui:CardControl>

                <!-- Privacy Disclaimer -->
                <Border Background="{DynamicResource SystemFillColorCautionBackgroundBrush}"
                        CornerRadius="8"
                        Padding="16"
                        Margin="0,0,0,16"
                        Visibility="{Binding DisclaimerAccepted, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <ui:SymbolIcon Symbol="Warning24" 
                                           Foreground="{DynamicResource SystemFillColorCautionBrush}"
                                           Margin="0,0,8,0"/>
                            <TextBlock Text="Privacy Notice" 
                                       FontWeight="Bold" 
                                       FontSize="14"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" 
                                   Margin="0,0,0,12"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}">
                            When AI features are enabled, AutoDrop will send file content (images and text) 
                            to Google's Gemini API for analysis. This helps categorize and rename your files 
                            intelligently. Your files are processed according to Google's AI privacy policy.
                        </TextBlock>
                        <ui:Button Content="I Understand and Accept"
                                   Appearance="Primary"
                                   Command="{Binding AcceptDisclaimerCommand}"
                                   HorizontalAlignment="Left"/>
                    </StackPanel>
                </Border>

                <!-- Accepted Badge -->
                <Border Background="{DynamicResource SystemFillColorSuccessBackgroundBrush}"
                        CornerRadius="8"
                        Padding="12"
                        Margin="0,0,0,16"
                        Visibility="{Binding DisclaimerAccepted, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <ui:SymbolIcon Symbol="CheckmarkCircle24" 
                                       Foreground="{DynamicResource SystemFillColorSuccessBrush}"
                                       Margin="0,0,8,0"/>
                        <TextBlock Text="Privacy terms accepted" 
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- API Key Section -->
                <TextBlock Text="API Configuration" 
                           FontWeight="SemiBold" 
                           FontSize="16"
                           Margin="0,0,0,12"/>

                <ui:CardControl Margin="0,0,0,16">
                    <ui:CardControl.Header>
                        <StackPanel>
                            <TextBlock Text="Gemini API Key" 
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,4"/>
                            <TextBlock Text="Get your free API key from Google AI Studio"
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                       FontSize="12"/>
                        </StackPanel>
                    </ui:CardControl.Header>
                    <StackPanel Margin="0,12,0,0">
                        <ui:TextBox PlaceholderText="Enter your Gemini API key..."
                                    Text="{Binding ApiKey, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Margin="0,0,0,12"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <ui:Button Grid.Column="0"
                                       Content="Validate Key"
                                       Icon="{ui:SymbolIcon Checkmark24}"
                                       Command="{Binding ValidateApiKeyCommand}"
                                       IsEnabled="{Binding IsValidating, Converter={StaticResource InverseBoolConverter}}"/>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding ValidationStatus}"
                                       VerticalAlignment="Center"
                                       Margin="12,0,0,0"
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                        </Grid>
                        <ui:HyperlinkButton Content="Get API Key from Google AI Studio â†’"
                                            NavigateUri="https://aistudio.google.com/apikey"
                                            Margin="0,8,0,0"/>
                    </StackPanel>
                </ui:CardControl>

                <!-- Feature Toggles -->
                <TextBlock Text="AI Features" 
                           FontWeight="SemiBold" 
                           FontSize="16"
                           Margin="0,8,0,12"/>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="ðŸ‘ï¸ Vision Drop" FontWeight="SemiBold"/>
                                <TextBlock Text="Analyze images to detect content (pets, landscapes, receipts, etc.)"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                           FontSize="12"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                            <ui:ToggleSwitch Grid.Column="1" 
                                          IsChecked="{Binding EnableVisionAnalysis, Mode=TwoWay}"
                                          VerticalAlignment="Center"/>
                        </Grid>
                    </ui:CardControl.Header>
                </ui:CardControl>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="ðŸ§  Smart Context" FontWeight="SemiBold"/>
                                <TextBlock Text="Read documents to classify them (invoices, contracts, resumes, etc.)"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                           FontSize="12"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                            <ui:ToggleSwitch Grid.Column="1" 
                                          IsChecked="{Binding EnableDocumentAnalysis, Mode=TwoWay}"
                                          VerticalAlignment="Center"/>
                        </Grid>
                    </ui:CardControl.Header>
                </ui:CardControl>

                <ui:CardControl Margin="0,0,0,16">
                    <ui:CardControl.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="âœ¨ Magic Rename" FontWeight="SemiBold"/>
                                <TextBlock Text="Suggest descriptive filenames based on content"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                           FontSize="12"
                                           TextWrapping="Wrap"/>
                            </StackPanel>
                            <ui:ToggleSwitch Grid.Column="1" 
                                          IsChecked="{Binding EnableSmartRename, Mode=TwoWay}"
                                          VerticalAlignment="Center"/>
                        </Grid>
                    </ui:CardControl.Header>
                </ui:CardControl>

                <!-- Advanced Settings -->
                <TextBlock Text="Advanced" 
                           FontWeight="SemiBold" 
                           FontSize="16"
                           Margin="0,8,0,12"/>

                <ui:CardControl Margin="0,0,0,8">
                    <ui:CardControl.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="120"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Confidence Threshold" FontWeight="SemiBold"/>
                                <TextBlock Text="Minimum confidence score to apply AI suggestions"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                           FontSize="12"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                <Slider Width="80" 
                                        Minimum="0.5" 
                                        Maximum="1.0" 
                                        TickFrequency="0.1"
                                        IsSnapToTickEnabled="True"
                                        Value="{Binding ConfidenceThreshold, Mode=TwoWay}"
                                        VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding ConfidenceThreshold, StringFormat={}{0:P0}}"
                                           Width="40"
                                           TextAlignment="Right"
                                           VerticalAlignment="Center"
                                           Margin="8,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </ui:CardControl.Header>
                </ui:CardControl>

                <ui:CardControl Margin="0,0,0,16">
                    <ui:CardControl.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Max File Size" FontWeight="SemiBold"/>
                                <TextBlock Text="Skip AI analysis for files larger than this"
                                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                           FontSize="12"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                <ui:NumberBox Value="{Binding MaxFileSizeMb, Mode=TwoWay}"
                                              Minimum="1"
                                              Maximum="50"
                                              SpinButtonPlacementMode="Compact"
                                              Width="70"/>
                                <TextBlock Text="MB" 
                                           VerticalAlignment="Center"
                                           Margin="8,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </ui:CardControl.Header>
                </ui:CardControl>

            </StackPanel>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="2"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="0,1,0,0"
                Padding="24,16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0"
                           Text="Unsaved changes"
                           Foreground="{DynamicResource SystemFillColorCautionBrush}"
                           VerticalAlignment="Center"
                           Visibility="{Binding HasUnsavedChanges, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <ui:Button Content="Cancel"
                               Click="OnCancelClick"
                               Margin="0,0,12,0"/>
                    <ui:Button Content="Save Settings"
                               Appearance="Primary"
                               Icon="{ui:SymbolIcon Save24}"
                               Command="{Binding SaveSettingsCommand}"
                               Click="OnSaveClick"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</ui:FluentWindow>
